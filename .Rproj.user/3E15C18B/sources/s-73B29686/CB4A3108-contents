### Functions for formatting data retrieved from the API

#' Format raw Commons divisions tibble
#'
#' @param df The divisions tibble retrieved from the API
#' @keywords internal

format_cds_raw <- function(df) {

    # Column names
    df <- df %>% janitor::clean_names()
    df <- df %>% dplyr::rename(
        division_date = date,
        division_title = title,
        division_number = number)

    # As character
    df <- df %>% dplyr::mutate(
        dplyr::across(
            c(division_id,
            division_number),
        as.character))

    # As date
    df <- df %>% dplyr::mutate(
        dplyr::across(
            c(division_date,
              publication_updated,
              remote_voting_start,
              remote_voting_end),
            as.Date))

    # Tidy and return
    df %>%
        dplyr::arrange(
            .data$division_date,
            .data$division_number) %>%
        dplyr::mutate_if(is.character, list(~dplyr::na_if(.,""))) %>%
        dplyr::mutate_if(is.character, stringr::str_trim)

}

#' Format raw Commons divisions votes tibble
#'
#' @param df The divisions vote tibble retrieved from the API
#' @keywords internal

format_cds_votes_raw <- function(df) {

    # Column names
    df <- df %>% janitor::clean_names()

    # As character
    df <- df %>% dplyr::mutate(
        dplyr::across(
            c(division_id,
              division_number,
              member_id),
            as.character))

    # As date
    df <- df %>% dplyr::mutate(
        dplyr::across(
            division_date,
            as.Date))

    # Tidy and return
    df %>%
        dplyr::arrange(
            .data$division_date,
            .data$division_number) %>%
        dplyr::rename(
            mnis_id = .data$member_id) %>%
        dplyr::mutate_if(is.character, list(~dplyr::na_if(.,""))) %>%
        dplyr::mutate_if(is.character, stringr::str_trim)
}

format_cds_members_raw <- function(df) {

    # Column names
    df <- df %>% janitor::clean_names()

    # As character
    df <- df %>% dplyr::mutate(
        dplyr::across(
            c(published_division_division_id,
              published_division_number,
              member_id),
            as.character))

    # As date
    df <- df %>% dplyr::mutate(
        dplyr::across(
            published_division_date,
            as.Date))

    # Tidy and return
    df %>%
        dplyr::arrange(
            .data$member_id,
            .data$published_division_date,
            .data$published_division_number) %>%
        dplyr::rename(
            mnis_id = .data$member_id,
            division_id = .data$published_division_division_id,
            division_date = .data$published_division_date,
            division_number = .data$published_division_number,
            division_title = .data$published_division_title) %>%
        dplyr::mutate_if(is.character, list(~dplyr::na_if(.,""))) %>%
        dplyr::mutate_if(is.character, stringr::str_trim)

}
